// Generated by CoffeeScript 1.9.3
(function() {
  $(function() {
    var params, url_base;
    url_base = "http://localhost:8080";
    params = {};
    $.ajaxSetup({
      contentType: "application/json; charset=utf-8"
    });
    $("#wine-form").on("submit", function(e) {
      var bottle, cask, dor, file, form, grade, has, name, price, size, type, varietals;
      e.preventDefault();
      form = new FormData;
      has = function(i) {
        return i.val() !== '';
      };
      name = $("#wine-name");
      if (!has(name)) {
        return;
      }
      form.append('name', name.val());
      dor = $("#wine-do");
      form.append('do', dor.is(":checked"));
      type = $("#wine-type");
      form.append('type', type.val());
      if (type.val() === "red") {
        cask = $("#wine-cask");
        if (has(cask)) {
          form.append('cask', cask.val());
        }
        bottle = $("#wine-bottle");
        if (has(bottle)) {
          form.append('bottle', bottle.val());
        }
      }
      grade = $("#wine-grade");
      if (has(grade)) {
        form.append('grade', grade.val());
      }
      price = $("#wine-price");
      if (has(price)) {
        form.append('price', price.val());
      }
      size = $("#wine-size");
      if (has(size)) {
        form.append('size', size.val());
      }
      varietals = $("#wine-varietals");
      if (has(varietals)) {
        form.append('varietals', varietals.val().split(/[\s,]+/));
      }
      file = $("#wine-file");
      if (has(file)) {
        form.append('photo', file.prop('files')[0], file.val());
      }
      return $.ajax({
        type: 'POST',
        url: url_base + "/fake",
        contentType: 'multipart/form-data',
        headers: {
          "Authorization": "Basic " + params.auth_basic
        },
        data: form,
        cache: false,
        processData: false,
        success: function(data) {
          return alert(data);
        }
      });
    });
    $('#auth-form').on("submit", function(e) {
      var j, json, len, v, vals;
      e.preventDefault();
      vals = $(this).serializeArray();
      json = {};
      for (j = 0, len = vals.length; j < len; j++) {
        v = vals[j];
        json[v.name] = v.value;
      }
      json = JSON.stringify(json);
      return $.post(url_base + "/submit_wine", json, function(data) {
        params.auth_basic = data.auth_basic;
        params.upload_url = data.upload_url;
        return $('#auth-form, #wine-form').toggleClass("hide");
      }).fail(function() {
        $("input[type=text], input[type=password]").val('');
        return $("#big-title").after("<div class='alert alert-danger'> <button class='close' data-dismiss='alert'><span>&times;</span></button> Error de autenticaci√≥n </div>");
      });
    });
    $("select").on("change", function() {
      var val;
      val = $("select option:selected").val();
      if (val !== "red") {
        return $("#red-options").addClass("hide");
      } else {
        return $("#red-options").removeClass("hide");
      }
    });
    return $("label").css("margin-top", "10px");
  });

}).call(this);
