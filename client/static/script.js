// Generated by CoffeeScript 1.9.3
(function() {
  $(function() {
    var filter, insertWines, url_base;
    url_base = "http://localhost:8002";
    insertWines = function(wines) {
      var i, len, panel_div, results, row, w, wines_div;
      wines_div = $("#wines");
      wines_div.empty();
      results = [];
      for (i = 0, len = wines.length; i < len; i++) {
        w = wines[i];
        row = $.parseHTML("<div class='row'> <div class='panel panel-primary'> <div class='panel-body' id='panel-" + w.url + "'-> </div> </div> </div>");
        wines_div.append(row);
        panel_div = $("#panel-" + w.url);
        panel_div.append("<input type='checkbox' name='vehicle' value='" + w.url + "'> <b>" + w.name + "</b> ");
        if (w.grade) {
          panel_div.append("- " + w.grade + " grados ");
        }
        if (w.size) {
          panel_div.append("- " + w.size + " centilitros ");
        }
        if (w.price) {
          panel_div.append("- " + w.price + " € ");
        }
        if (w["do"]) {
          panel_div.append("- Denominación de Origen La Mancha ");
        }
        if (w.cask) {
          panel_div.append("- " + w.cask + " años de envejecimiento en barrica ");
        }
        if (w.bottle) {
          results.push(panel_div.append("- " + w.bottle + " años de envejecimiento en botella "));
        } else {
          results.push(void 0);
        }
      }
      return results;
    };
    $.ajaxSetup({
      contentType: "application/json; charset=utf-8"
    });
    filter = function(type) {
      if (type == null) {
        type = null;
      }
      if (type != null) {
        return $.get(url_base + ("/filterByType/" + type), function(data) {
          return insertWines(data['all']);
        });
      } else {
        return $.get(url_base + "/allWines", function(data) {
          return insertWines(data['all']);
        });
      }
    };
    filter();
    $("#pink-wines").on("click", filter.bind(this, "pink"));
    $("#red-wines").on("click", filter.bind(this, "red"));
    $("#white-wines").on("click", filter.bind(this, "white"));
    $("#all-wines").on("click", filter.bind(this, null));
    $("#filter-name").on("click", function() {
      var name;
      name = $("#name").val();
      if (!name) {
        $("#name-filter").addClass("has-error");
        return;
      }
      $(".has-error").removeClass("has-error");
      return $.get(url_base + ("/filterByName/" + name), function(data) {
        return insertWines(data['all']);
      });
    });
    $("#filter-prices").on("click", function() {
      var max, min, values;
      min = parseFloat($("#minimo").val());
      max = parseFloat($("#maximo").val());
      if (isNaN(min) || isNaN(max)) {
        $("#prices-filter").addClass("has-error");
        return;
      }
      $(".has-error").removeClass("has-error");
      values = JSON.stringify({
        "min": min,
        "max": max
      });
      return $.post(url_base + "/filterByPrices", values, function(data) {
        return insertWines(data['all']);
      });
    });
    return $("#create-cart").on("click", function() {
      var name, values, wines;
      name = $("#cart-name").val();
      wines = $("input:checkbox:checked").map(function() {
        return $(this).val();
      });
      values = {
        "items": wines.get()
      };
      if (name) {
        values['name'] = name;
      }
      values = JSON.stringify(values);
      return $.post(url_base + "/postCart", values, function(data) {
        return $("#big-title").after("<div class='alert alert-success'> <button class='close' data-dismiss='alert'><span>&times;</span></button> Carrito '" + data['created'] + "' creado </div>");
      });
    });
  });

}).call(this);
